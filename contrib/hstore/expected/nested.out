select 'ff => {a=>12, b=>16}'::hstore;
            hstore            
------------------------------
 "ff"=>{"a"=>"12", "b"=>"16"}
(1 row)

select 'ff => {a=>12, b=>16}, qq=> 123'::hstore;
                  hstore                   
-------------------------------------------
 "ff"=>{"a"=>"12", "b"=>"16"}, "qq"=>"123"
(1 row)

select 'aa => {a,aaa}, qq=>{ a=>12, b=>16 , c=> { c1, c2}, d=>{d1=>d1, d2=>d2, d1=>d3} }'::hstore;
                                               hstore                                               
----------------------------------------------------------------------------------------------------
 "aa"=>{"a", "aaa"}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{"c1", "c2"}, "d"=>{"d1"=>"d3", "d2"=>"d2"}}
(1 row)

select '"aa"=>{a,aaa}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{c1,c2}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}'::hstore;
                                               hstore                                               
----------------------------------------------------------------------------------------------------
 "aa"=>{"a", "aaa"}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{"c1", "c2"}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}
(1 row)

select '"aa"=>{a,aaa}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{c1,c2,{c3},{c4=>4}}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}'::hstore;
                                                         hstore                                                          
-------------------------------------------------------------------------------------------------------------------------
 "aa"=>{"a", "aaa"}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{"c1", "c2", {"c3"}, {"c4"=>"4"}}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}
(1 row)

select 'ff => {a,aaa}'::hstore;
       hstore       
--------------------
 "ff"=>{"a", "aaa"}
(1 row)

--test optional outer braces
SELECT	'a=>1'::hstore;
  hstore  
----------
 "a"=>"1"
(1 row)

SELECT	'{a=>1}'::hstore;
  hstore  
----------
 "a"=>"1"
(1 row)

SELECT	'a,b'::hstore;
   hstore   
------------
 {"a", "b"}
(1 row)

SELECT	'{a,b}'::hstore;
   hstore   
------------
 {"a", "b"}
(1 row)

SELECT	'a,{b}'::hstore;
    hstore    
--------------
 {"a", {"b"}}
(1 row)

SELECT	'{a,{b}}'::hstore;
    hstore    
--------------
 {"a", {"b"}}
(1 row)

SELECT	'{a},b'::hstore;
    hstore    
--------------
 {{"a"}, "b"}
(1 row)

SELECT	'{{a},b}'::hstore;
    hstore    
--------------
 {{"a"}, "b"}
(1 row)

SELECT	'a,{b},{c}'::hstore;
       hstore        
---------------------
 {"a", {"b"}, {"c"}}
(1 row)

SELECT	'{a,{b},{c}}'::hstore;
       hstore        
---------------------
 {"a", {"b"}, {"c"}}
(1 row)

SELECT	'{a},{b},c'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"}, "c"}
(1 row)

SELECT	'{{a},{b},c}'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"}, "c"}
(1 row)

SELECT	'{a},b,{c}'::hstore;
       hstore        
---------------------
 {{"a"}, "b", {"c"}}
(1 row)

SELECT	'{{a},b,{c}}'::hstore;
       hstore        
---------------------
 {{"a"}, "b", {"c"}}
(1 row)

SELECT	'a,{b=>1}'::hstore;
      hstore       
-------------------
 {"a", {"b"=>"1"}}
(1 row)

SELECT	'{a,{b=>1}}'::hstore;
      hstore       
-------------------
 {"a", {"b"=>"1"}}
(1 row)

SELECT	'{a},{b=>1}'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"=>"1"}}
(1 row)

SELECT	'{{a},{b=>1}}'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"=>"1"}}
(1 row)

SELECT	'{a},{b=>1},{c}'::hstore;
           hstore           
----------------------------
 {{"a"}, {"b"=>"1"}, {"c"}}
(1 row)

SELECT	'{{a},{b=>1},{c}}'::hstore;
           hstore           
----------------------------
 {{"a"}, {"b"=>"1"}, {"c"}}
(1 row)

SELECT	'a'::hstore;
 hstore 
--------
 {"a"}
(1 row)

SELECT	'{a}'::hstore;
 hstore 
--------
 {"a"}
(1 row)

SELECT	''::hstore;
 hstore 
--------
 
(1 row)

SELECT	'{}'::hstore;
 hstore 
--------
 
(1 row)

--nested json
SELECT	hstore_to_json('a=>1');
 hstore_to_json 
----------------
 {"a": "1"}
(1 row)

SELECT	hstore_to_json('{a=>1}');
 hstore_to_json 
----------------
 {"a": "1"}
(1 row)

SELECT	hstore_to_json('a,b');
 hstore_to_json 
----------------
 ["a", "b"]
(1 row)

SELECT	hstore_to_json('{a,b}');
 hstore_to_json 
----------------
 ["a", "b"]
(1 row)

SELECT	hstore_to_json('a,{b}');
 hstore_to_json 
----------------
 ["a", ["b"]]
(1 row)

SELECT	hstore_to_json('{a,{b}}');
 hstore_to_json 
----------------
 ["a", ["b"]]
(1 row)

SELECT	hstore_to_json('{a},b');
 hstore_to_json 
----------------
 [["a"], "b"]
(1 row)

SELECT	hstore_to_json('{{a},b}');
 hstore_to_json 
----------------
 [["a"], "b"]
(1 row)

SELECT	hstore_to_json('a,{b},{c}');
   hstore_to_json    
---------------------
 ["a", ["b"], ["c"]]
(1 row)

SELECT	hstore_to_json('{a,{b},{c}}');
   hstore_to_json    
---------------------
 ["a", ["b"], ["c"]]
(1 row)

SELECT	hstore_to_json('{a},{b},c');
   hstore_to_json    
---------------------
 [["a"], ["b"], "c"]
(1 row)

SELECT	hstore_to_json('{{a},{b},c}');
   hstore_to_json    
---------------------
 [["a"], ["b"], "c"]
(1 row)

SELECT	hstore_to_json('{a},b,{c}');
   hstore_to_json    
---------------------
 [["a"], "b", ["c"]]
(1 row)

SELECT	hstore_to_json('{{a},b,{c}}');
   hstore_to_json    
---------------------
 [["a"], "b", ["c"]]
(1 row)

SELECT	hstore_to_json('a,{b=>1}');
  hstore_to_json   
-------------------
 ["a", {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{a,{b=>1}}');
  hstore_to_json   
-------------------
 ["a", {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{a},{b=>1}');
   hstore_to_json    
---------------------
 [["a"], {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{{a},{b=>1}}');
   hstore_to_json    
---------------------
 [["a"], {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{a},{b=>1},{c}');
       hstore_to_json       
----------------------------
 [["a"], {"b": "1"}, ["c"]]
(1 row)

SELECT	hstore_to_json('{{a},{b=>1},{c}}');
       hstore_to_json       
----------------------------
 [["a"], {"b": "1"}, ["c"]]
(1 row)

SELECT	hstore_to_json('a');
 hstore_to_json 
----------------
 ["a"]
(1 row)

SELECT	hstore_to_json('{a}');
 hstore_to_json 
----------------
 ["a"]
(1 row)

SELECT	hstore_to_json('');
 hstore_to_json 
----------------
 
(1 row)

SELECT	hstore_to_json('{}');
 hstore_to_json 
----------------
 
(1 row)

select hstore_to_json('"aa"=>{a,aaa}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{c1,c2,{c3},{c4=>4}}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}'::hstore);
                                                      hstore_to_json                                                       
---------------------------------------------------------------------------------------------------------------------------
 {"aa": ["a", "aaa"], "qq": {"a": "12", "b": "16", "c": ["c1", "c2", ["c3"], {"c4": "4"}], "d": {"d1": "d1", "d2": "d2"}}}
(1 row)

--
SELECT 'ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'ff', 
	   'ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'qq', 
	   ('ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'Y') IS NULL AS t, 
	   'ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'x'; 
       ?column?       | ?column? | t |  ?column?  
----------------------+----------+---+------------
 "a"=>"12", "b"=>"16" | 123      | t | {"1", "2"}
(1 row)

SELECT '[ a, b, c, d]'::hstore -> 'a';
 ?column? 
----------
 a
(1 row)

--
CREATE TABLE testtype (i int, h hstore, a int[]);
INSERT INTO testtype VALUES (1, 'a=>1', '{1,2,3}');
SELECT populate_record(v, 'i=>2'::hstore) FROM testtype v;
       populate_record        
------------------------------
 (2,"""a""=>""1""","{1,2,3}")
(1 row)

SELECT populate_record(v, 'i=>2, a=>{7,8,9}'::hstore) FROM testtype v;
       populate_record        
------------------------------
 (2,"""a""=>""1""","{7,8,9}")
(1 row)

SELECT populate_record(v, 'i=>2, h=>{b=>3}, a=>{7,8,9}'::hstore) FROM testtype v;
       populate_record        
------------------------------
 (2,"""b""=>""3""","{7,8,9}")
(1 row)

--complex delete
select 'b=>{a,c}'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select 'b=>{a,c}, a=>1'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select 'b=>{a,c}, a=>[2,3]'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select 'b=>{a,c}, a=>[2,3]'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select '[2,3,a]'::hstore - 'a'::text;
  ?column?  
------------
 {"2", "3"}
(1 row)

select '[a,2,3,a]'::hstore - 'a'::text;
  ?column?  
------------
 {"2", "3"}
(1 row)

select '[a,a]'::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select '[a]'::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select 'a=>1'::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select ''::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select 'a, 1 , b,2, c,3'::hstore - ARRAY['d','b'];
         ?column?          
---------------------------
 {"a", "1", "2", "c", "3"}
(1 row)

select 'a=>{1,2}, v=>23, b=>c'::hstore - 'v'::hstore;
         ?column?          
---------------------------
 "a"=>{"1", "2"}, "b"=>"c"
(1 row)

select 'a=>{1,2}, v=>23, b=>c'::hstore - 'v=>23'::hstore;
         ?column?          
---------------------------
 "a"=>{"1", "2"}, "b"=>"c"
(1 row)

select 'a=>{1,2}, v=>23, b=>c'::hstore - 'v=>{1,2}'::hstore;
               ?column?               
--------------------------------------
 "a"=>{"1", "2"}, "b"=>"c", "v"=>"23"
(1 row)

select 'a=>{1,2}, v=>23, b=>c'::hstore - 'a=>{1,2}'::hstore;
      ?column?       
---------------------
 "b"=>"c", "v"=>"23"
(1 row)

select 'a, {1,2}, v, 23, b, c'::hstore - 'v'::hstore;
             ?column?              
-----------------------------------
 {"a", {"1", "2"}, "23", "b", "c"}
(1 row)

select 'a, {1,2}, v, 23, b, c'::hstore - 'v=>23'::hstore;
          ?column?           
-----------------------------
 {"a", {"1", "2"}, "b", "c"}
(1 row)

select 'a, {1,2}, v, 23, b, c'::hstore - 'v,23'::hstore;
          ?column?           
-----------------------------
 {"a", {"1", "2"}, "b", "c"}
(1 row)

select 'a, {1,2}, v, 23, b, c'::hstore - 'v,{1,2}'::hstore;
       ?column?        
-----------------------
 {"a", "23", "b", "c"}
(1 row)

--joining
select 'aa=>1 , b=>2, cq=>3'::hstore || 'cq,l, b,g, fg,f, 1,2'::hstore;
                      ?column?                       
-----------------------------------------------------
 "1"=>"2", "b"=>"g", "aa"=>"1", "cq"=>"l", "fg"=>"f"
(1 row)

select 'aa,1 , b,2, cq,3'::hstore || 'cq,l, b,g, fg,f, 1,2'::hstore;
                                  ?column?                                  
----------------------------------------------------------------------------
 {"aa", "1", "b", "2", "cq", "3", "cq", "l", "b", "g", "fg", "f", "1", "2"}
(1 row)

--slice
select slice_array(hstore 'aa=>1, b=>2, c=>3', ARRAY['g','h','i']);
   slice_array    
------------------
 {NULL,NULL,NULL}
(1 row)

select slice_array(hstore 'aa,1, b,2, c,3', ARRAY['g','h','i']);
   slice_array    
------------------
 {NULL,NULL,NULL}
(1 row)

select slice_array(hstore 'aa=>1, b=>2, c=>3', ARRAY['b','c']);
 slice_array 
-------------
 {2,3}
(1 row)

select slice_array(hstore 'aa,1, b,2, c,3', ARRAY['b','c']);
 slice_array 
-------------
 {b,c}
(1 row)

select slice_array(hstore 'aa=>1, b=>{2=>1}, c=>{1,2}', ARRAY['b','c']);
            slice_array            
-----------------------------------
 {"\"2\"=>\"1\"","{\"1\", \"2\"}"}
(1 row)

select slice(hstore 'aa=>1, b=>2, c=>3', ARRAY['g','h','i']);
 slice 
-------
 
(1 row)

select slice(hstore 'aa,1, b,2, c,3', ARRAY['g','h','i']);
 slice 
-------
 
(1 row)

select slice(hstore 'aa=>1, b=>2, c=>3', ARRAY['b','c']);
       slice        
--------------------
 "b"=>"2", "c"=>"3"
(1 row)

select slice(hstore 'aa,1, b,2, c,3', ARRAY['b','c']);
   slice    
------------
 {"b", "c"}
(1 row)

select slice(hstore 'aa=>1, b=>{2=>1}, c=>{1,2}', ARRAY['b','c']);
              slice               
----------------------------------
 "b"=>{"2"=>"1"}, "c"=>{"1", "2"}
(1 row)

--to array
select %% 'aa=>1, cq=>l, b=>{a,n}, fg=>NULL';
               ?column?                
---------------------------------------
 {b,"{\"a\", NULL}",aa,1,cq,l,fg,NULL}
(1 row)

select %% 'aa,1, cq,l, b,g, fg,NULL';
        ?column?         
-------------------------
 {aa,1,cq,l,b,g,fg,NULL}
(1 row)

select hstore_to_matrix( 'aa=>1, cq=>l, b=>{a,n}, fg=>NULL');
               hstore_to_matrix                
-----------------------------------------------
 {{b,"{\"a\", NULL}"},{aa,1},{cq,l},{fg,NULL}}
(1 row)

select hstore_to_matrix( 'aa,1, cq,l, b,g, fg,NULL');
        hstore_to_matrix         
---------------------------------
 {{aa,1},{cq,l},{b,g},{fg,NULL}}
(1 row)

--contains
select 'a=>b'::hstore @> 'a=>b, c=>b';
 ?column? 
----------
 f
(1 row)

select 'a=>b, c=>b'::hstore @> 'a=>b';
 ?column? 
----------
 t
(1 row)

select 'a=>{1,2}, c=>b'::hstore @> 'a=>{1,2}';
 ?column? 
----------
 t
(1 row)

select 'a=>{2,1}, c=>b'::hstore @> 'a=>{1,2}';
 ?column? 
----------
 f
(1 row)

select 'a=>{1=>2}, c=>b'::hstore @> 'a=>{1,2}';
 ?column? 
----------
 f
(1 row)

select 'a=>{2=>1}, c=>b'::hstore @> 'a=>{1,2}';
 ?column? 
----------
 f
(1 row)

select 'a=>{1=>2}, c=>b'::hstore @> 'a=>{1=>2}';
 ?column? 
----------
 t
(1 row)

select 'a=>{2=>1}, c=>b'::hstore @> 'a=>{1=>2}';
 ?column? 
----------
 f
(1 row)

select 'a,b'::hstore @> 'a,b, c,b';
 ?column? 
----------
 f
(1 row)

select 'a,b, c,b'::hstore @> 'a,b';
 ?column? 
----------
 t
(1 row)

select 'a,b, c,{1,2}'::hstore @> 'a,{1,2}';
 ?column? 
----------
 t
(1 row)

select 'a,b, c,{1,2}'::hstore @> 'b,{1,2}';
 ?column? 
----------
 t
(1 row)

-- %>
SELECT 'n=>NULL, a=>1, b=>{1,2}, c=>{1=>2}, d=>{1=>{2,3}}'::hstore %> 'n';
 ?column? 
----------
 
(1 row)

SELECT 'n=>NULL, a=>1, b=>{1,2}, c=>{1=>2}, d=>{1=>{2,3}}'::hstore %> 'a';
 ?column? 
----------
 {"1"}
(1 row)

SELECT 'n=>NULL, a=>1, b=>{1,2}, c=>{1=>2}, d=>{1=>{2,3}}'::hstore %> 'b';
  ?column?  
------------
 {"1", "2"}
(1 row)

SELECT 'n=>NULL, a=>1, b=>{1,2}, c=>{1=>2}, d=>{1=>{2,3}}'::hstore %> 'c';
 ?column? 
----------
 "1"=>"2"
(1 row)

SELECT 'n=>NULL, a=>1, b=>{1,2}, c=>{1=>2}, d=>{1=>{2,3}}'::hstore %> 'd';
    ?column?     
-----------------
 "1"=>{"2", "3"}
(1 row)

SELECT 'n=>NULL, a=>1, b=>{1,2}, c=>{1=>2}, d=>{1=>{2,3}}'::hstore %> 'd' %> '1';
  ?column?  
------------
 {"2", "3"}
(1 row)

SELECT '1,2,3,{a,b}'::hstore %> '1';
 ?column? 
----------
 {"1"}
(1 row)

--decoration
SET hstore.array_brackets=false;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                a                 
----------------------------------------------+----------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}} | "a", {"b"=>"c"}, {"c", "d", "e"}
(1 row)

SET hstore.array_brackets=false;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                a                 
------------------------------------------------+----------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}}} | "a", {"b"=>"c"}, {"c", "d", "e"}
(1 row)

SET hstore.array_brackets=false;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                 a                  
----------------------------------------------+------------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}} | {"a", {"b"=>"c"}, {"c", "d", "e"}}
(1 row)

SET hstore.array_brackets=false;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                 a                  
------------------------------------------------+------------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}}} | {"a", {"b"=>"c"}, {"c", "d", "e"}}
(1 row)

SET hstore.array_brackets=true;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                a                 
----------------------------------------------+----------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]] | "a", {"b"=>"c"}, ["c", "d", "e"]
(1 row)

SET hstore.array_brackets=true;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                a                 
------------------------------------------------+----------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]]} | "a", {"b"=>"c"}, ["c", "d", "e"]
(1 row)

SET hstore.array_brackets=true;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                 a                  
----------------------------------------------+------------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]] | ["a", {"b"=>"c"}, ["c", "d", "e"]]
(1 row)

SET hstore.array_brackets=true;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                 a                  
------------------------------------------------+------------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]]} | ["a", {"b"=>"c"}, ["c", "d", "e"]]
(1 row)

RESET hstore.array_brackets;
RESET hstore.root_array_decorated;
RESET hstore.root_hash_decorated;
