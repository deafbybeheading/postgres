select 'ff => {a=>12, b=>16}'::hstore;
            hstore            
------------------------------
 "ff"=>{"a"=>"12", "b"=>"16"}
(1 row)

select 'ff => {a=>12, b=>16}, qq=> 123'::hstore;
                  hstore                   
-------------------------------------------
 "ff"=>{"a"=>"12", "b"=>"16"}, "qq"=>"123"
(1 row)

select 'aa => {a,aaa}, qq=>{ a=>12, b=>16 , c=> { c1, c2}, d=>{d1=>d1, d2=>d2, d1=>d3} }'::hstore;
                                               hstore                                               
----------------------------------------------------------------------------------------------------
 "aa"=>{"a", "aaa"}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{"c1", "c2"}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}
(1 row)

select '"aa"=>{a,aaa}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{c1,c2}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}'::hstore;
                                               hstore                                               
----------------------------------------------------------------------------------------------------
 "aa"=>{"a", "aaa"}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{"c1", "c2"}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}
(1 row)

select '"aa"=>{a,aaa}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{c1,c2,{c3},{c4=>4}}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}'::hstore;
                                                         hstore                                                          
-------------------------------------------------------------------------------------------------------------------------
 "aa"=>{"a", "aaa"}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{"c1", "c2", {"c3"}, {"c4"=>"4"}}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}
(1 row)

select 'ff => {a,aaa}'::hstore;
       hstore       
--------------------
 "ff"=>{"a", "aaa"}
(1 row)

--test optional outer braces
SELECT	'a=>1'::hstore;
  hstore  
----------
 "a"=>"1"
(1 row)

SELECT	'{a=>1}'::hstore;
  hstore  
----------
 "a"=>"1"
(1 row)

SELECT	'a,b'::hstore;
   hstore   
------------
 {"a", "b"}
(1 row)

SELECT	'{a,b}'::hstore;
   hstore   
------------
 {"a", "b"}
(1 row)

SELECT	'a,{b}'::hstore;
    hstore    
--------------
 {"a", {"b"}}
(1 row)

SELECT	'{a,{b}}'::hstore;
    hstore    
--------------
 {"a", {"b"}}
(1 row)

SELECT	'{a},b'::hstore;
    hstore    
--------------
 {{"a"}, "b"}
(1 row)

SELECT	'{{a},b}'::hstore;
    hstore    
--------------
 {{"a"}, "b"}
(1 row)

SELECT	'a,{b},{c}'::hstore;
       hstore        
---------------------
 {"a", {"b"}, {"c"}}
(1 row)

SELECT	'{a,{b},{c}}'::hstore;
       hstore        
---------------------
 {"a", {"b"}, {"c"}}
(1 row)

SELECT	'{a},{b},c'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"}, "c"}
(1 row)

SELECT	'{{a},{b},c}'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"}, "c"}
(1 row)

SELECT	'{a},b,{c}'::hstore;
       hstore        
---------------------
 {{"a"}, "b", {"c"}}
(1 row)

SELECT	'{{a},b,{c}}'::hstore;
       hstore        
---------------------
 {{"a"}, "b", {"c"}}
(1 row)

SELECT	'a,{b=>1}'::hstore;
      hstore       
-------------------
 {"a", {"b"=>"1"}}
(1 row)

SELECT	'{a,{b=>1}}'::hstore;
      hstore       
-------------------
 {"a", {"b"=>"1"}}
(1 row)

SELECT	'{a},{b=>1}'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"=>"1"}}
(1 row)

SELECT	'{{a},{b=>1}}'::hstore;
       hstore        
---------------------
 {{"a"}, {"b"=>"1"}}
(1 row)

SELECT	'{a},{b=>1},{c}'::hstore;
           hstore           
----------------------------
 {{"a"}, {"b"=>"1"}, {"c"}}
(1 row)

SELECT	'{{a},{b=>1},{c}}'::hstore;
           hstore           
----------------------------
 {{"a"}, {"b"=>"1"}, {"c"}}
(1 row)

SELECT	'a'::hstore;
 hstore 
--------
 {"a"}
(1 row)

SELECT	'{a}'::hstore;
 hstore 
--------
 {"a"}
(1 row)

SELECT	''::hstore;
 hstore 
--------
 
(1 row)

SELECT	'{}'::hstore;
 hstore 
--------
 
(1 row)

--nested json
SELECT	hstore_to_json('a=>1');
 hstore_to_json 
----------------
 {"a": "1"}
(1 row)

SELECT	hstore_to_json('{a=>1}');
 hstore_to_json 
----------------
 {"a": "1"}
(1 row)

SELECT	hstore_to_json('a,b');
 hstore_to_json 
----------------
 ["a", "b"]
(1 row)

SELECT	hstore_to_json('{a,b}');
 hstore_to_json 
----------------
 ["a", "b"]
(1 row)

SELECT	hstore_to_json('a,{b}');
 hstore_to_json 
----------------
 ["a", ["b"]]
(1 row)

SELECT	hstore_to_json('{a,{b}}');
 hstore_to_json 
----------------
 ["a", ["b"]]
(1 row)

SELECT	hstore_to_json('{a},b');
 hstore_to_json 
----------------
 [["a"], "b"]
(1 row)

SELECT	hstore_to_json('{{a},b}');
 hstore_to_json 
----------------
 [["a"], "b"]
(1 row)

SELECT	hstore_to_json('a,{b},{c}');
   hstore_to_json    
---------------------
 ["a", ["b"], ["c"]]
(1 row)

SELECT	hstore_to_json('{a,{b},{c}}');
   hstore_to_json    
---------------------
 ["a", ["b"], ["c"]]
(1 row)

SELECT	hstore_to_json('{a},{b},c');
   hstore_to_json    
---------------------
 [["a"], ["b"], "c"]
(1 row)

SELECT	hstore_to_json('{{a},{b},c}');
   hstore_to_json    
---------------------
 [["a"], ["b"], "c"]
(1 row)

SELECT	hstore_to_json('{a},b,{c}');
   hstore_to_json    
---------------------
 [["a"], "b", ["c"]]
(1 row)

SELECT	hstore_to_json('{{a},b,{c}}');
   hstore_to_json    
---------------------
 [["a"], "b", ["c"]]
(1 row)

SELECT	hstore_to_json('a,{b=>1}');
  hstore_to_json   
-------------------
 ["a", {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{a,{b=>1}}');
  hstore_to_json   
-------------------
 ["a", {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{a},{b=>1}');
   hstore_to_json    
---------------------
 [["a"], {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{{a},{b=>1}}');
   hstore_to_json    
---------------------
 [["a"], {"b": "1"}]
(1 row)

SELECT	hstore_to_json('{a},{b=>1},{c}');
       hstore_to_json       
----------------------------
 [["a"], {"b": "1"}, ["c"]]
(1 row)

SELECT	hstore_to_json('{{a},{b=>1},{c}}');
       hstore_to_json       
----------------------------
 [["a"], {"b": "1"}, ["c"]]
(1 row)

SELECT	hstore_to_json('a');
 hstore_to_json 
----------------
 ["a"]
(1 row)

SELECT	hstore_to_json('{a}');
 hstore_to_json 
----------------
 ["a"]
(1 row)

SELECT	hstore_to_json('');
 hstore_to_json 
----------------
 
(1 row)

SELECT	hstore_to_json('{}');
 hstore_to_json 
----------------
 
(1 row)

select hstore_to_json('"aa"=>{a,aaa}, "qq"=>{"a"=>"12", "b"=>"16", "c"=>{c1,c2,{c3},{c4=>4}}, "d"=>{"d1"=>"d1", "d2"=>"d2"}}'::hstore);
                                                      hstore_to_json                                                       
---------------------------------------------------------------------------------------------------------------------------
 {"aa": ["a", "aaa"], "qq": {"a": "12", "b": "16", "c": ["c1", "c2", ["c3"], {"c4": "4"}], "d": {"d1": "d1", "d2": "d2"}}}
(1 row)

--
SELECT 'ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'ff', 
	   'ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'qq', 
	   ('ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'Y') IS NULL AS t, 
	   'ff => {a=>12, b=>16}, qq=> 123, x=>{1,2}, Y=>NULL'::hstore -> 'x'; 
       ?column?       | ?column? | t |  ?column?  
----------------------+----------+---+------------
 "a"=>"12", "b"=>"16" | 123      | t | {"1", "2"}
(1 row)

SELECT '[ a, b, c, d]'::hstore -> 'a';
 ?column? 
----------
 a
(1 row)

--
CREATE TABLE testtype (i int, h hstore, a int[]);
INSERT INTO testtype VALUES (1, 'a=>1', '{1,2,3}');
SELECT populate_record(v, 'i=>2'::hstore) FROM testtype v;
       populate_record        
------------------------------
 (2,"""a""=>""1""","{1,2,3}")
(1 row)

SELECT populate_record(v, 'i=>2, a=>{7,8,9}'::hstore) FROM testtype v;
       populate_record        
------------------------------
 (2,"""a""=>""1""","{7,8,9}")
(1 row)

SELECT populate_record(v, 'i=>2, h=>{b=>3}, a=>{7,8,9}'::hstore) FROM testtype v;
       populate_record        
------------------------------
 (2,"""b""=>""3""","{7,8,9}")
(1 row)

--complex delete
select 'b=>{a,c}'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select 'b=>{a,c}, a=>1'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select 'b=>{a,c}, a=>[2,3]'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select 'b=>{a,c}, a=>[2,3]'::hstore - 'a'::text;
    ?column?     
-----------------
 "b"=>{"a", "c"}
(1 row)

select '[2,3,a]'::hstore - 'a'::text;
  ?column?  
------------
 {"2", "3"}
(1 row)

select '[a,2,3,a]'::hstore - 'a'::text;
  ?column?  
------------
 {"2", "3"}
(1 row)

select '[a,a]'::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select '[a]'::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select 'a=>1'::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select ''::hstore - 'a'::text;
 ?column? 
----------
 
(1 row)

select 'a, 1 , b,2, c,3'::hstore - ARRAY['d','b'];
         ?column?          
---------------------------
 {"a", "1", "2", "c", "3"}
(1 row)

--decoration
SET hstore.array_square_brackets=false;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                a                 
----------------------------------------------+----------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}} | "a", {"b"=>"c"}, {"c", "d", "e"}
(1 row)

SET hstore.array_square_brackets=false;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                a                 
------------------------------------------------+----------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}}} | "a", {"b"=>"c"}, {"c", "d", "e"}
(1 row)

SET hstore.array_square_brackets=false;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                 a                  
----------------------------------------------+------------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}} | {"a", {"b"=>"c"}, {"c", "d", "e"}}
(1 row)

SET hstore.array_square_brackets=false;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                 a                  
------------------------------------------------+------------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>{"4", {"5"}}} | {"a", {"b"=>"c"}, {"c", "d", "e"}}
(1 row)

SET hstore.array_square_brackets=true;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                a                 
----------------------------------------------+----------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]] | "a", {"b"=>"c"}, ["c", "d", "e"]
(1 row)

SET hstore.array_square_brackets=true;
SET hstore.root_array_decorated=false;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                a                 
------------------------------------------------+----------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]]} | "a", {"b"=>"c"}, ["c", "d", "e"]
(1 row)

SET hstore.array_square_brackets=true;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=false;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                      h                       |                 a                  
----------------------------------------------+------------------------------------
 "a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]] | ["a", {"b"=>"c"}, ["c", "d", "e"]]
(1 row)

SET hstore.array_square_brackets=true;
SET hstore.root_array_decorated=true;
SET hstore.root_hash_decorated=true;
SELECT 'a=>1, b=>{c=>3}, d=>[4,[5]]'::hstore AS h, 'a, {b=>c}, [c, d, e]'::hstore AS a;
                       h                        |                 a                  
------------------------------------------------+------------------------------------
 {"a"=>"1", "b"=>{"c"=>"3"}, "d"=>["4", ["5"]]} | ["a", {"b"=>"c"}, ["c", "d", "e"]]
(1 row)

RESET hstore.array_square_brackets;
RESET hstore.root_array_decorated;
RESET hstore.root_hash_decorated;
